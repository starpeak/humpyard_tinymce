#= require 'tiny_mce/jquery.tinymce'
      
jQuery -> 
  jQuery('form').on 'humpyard:form:init', (e, form) ->  
    jQuery('textarea.wysiwyg', form).tinymce
      script_url : '<%= asset_path('tiny_mce/tiny_mce') %>',
      theme : "advanced",
    
      # Here we should add a sanatizer if the given locale is not supported by tinyMCE
      language : $('html').attr('lang') || 'en',
    
      plugins : "safari,pagebreak,style,layer,table,save,hylink,iespell,inlinepopups,insertdatetime,preview,searchreplace,print,paste,directionality,fullscreen,visualchars,nonbreaking,xhtmlxtras,template,contextmenu",
    
      theme_advanced_buttons1 : 'bold,italic,|,sub,sup,|,justifyleft,justifycenter,justifyright,|,bullist,numlist,table,|,link,unlink,|,hr,|,charmap,|,formatselect,|,undo,redo,|,code',
      theme_advanced_buttons2 : '',
      theme_advanced_buttons3 : '',
      theme_advanced_buttons4 : '',
    
      valid_elements: 'a[href|title],br[clear<all?left?none?right],strong/b,em/i,h1,h2,h3,img[alt= |border|height|longdesc|src|style|title|width],li,ol,p[style],sub,sup,ul,table,tr,th,td',
    
      theme_advanced_toolbar_location : "top",
      theme_advanced_toolbar_align : "left",
      theme_advanced_statusbar_location : "bottom",
      theme_advanced_resizing : true,
      content_css : '<%= asset_path('tiny_mce/content') %>',
      template_external_list_url : "lists/template_list.js",
      external_link_list_url : "lists/link_list.js",
      external_image_list_url : "lists/image_list.js",
      media_external_list_url : "lists/media_list.js",
      template_replace_values : 
        username : "Some User",
        staffid : "991234"
      
  jQuery('form').on 'humpyard:form:submit', (e) ->
    if typeof(tinyMCE) == 'object'
      tinyMCE.triggerSave()
